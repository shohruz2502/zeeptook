<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - Zeeptook</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        :root {
            --primary: #00f2fe;
            --primary-dark: #4facfe;
            --secondary: #0f172a;
            --accent: #ff6b6b;
            --google: #4285f4;
            --dark: #1e293b;
            --darker: #0f172a;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #cbd5e1;
            --white: #ffffff;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --gradient-dark: linear-gradient(135deg, var(--secondary) 0%, #1e3a8a 100%);
            --shadow: 0 8px 32px rgba(0, 242, 254, 0.15);
            --radius: 16px;
        }
        
        body {
            background: var(--gradient-dark);
            color: var(--white);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            line-height: 1.4;
        }

        .app-container {
            width: 100%;
            max-width: 400px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            margin-bottom: 8px;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 24px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: var(--gray-light);
            font-size: 14px;
            font-weight: 400;
        }
        
        .auth-card {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 242, 254, 0.1);
            overflow: hidden;
            padding: 24px 20px;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            color: var(--white);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 4px;
        }
        
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            border: none;
            background: transparent;
            color: var(--gray);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: var(--gradient);
            color: var(--white);
        }
        
        /* Google –∫–Ω–æ–ø–∫–∞ */
        .google-btn {
            width: 100%;
            padding: 14px 16px;
            border: none;
            border-radius: 12px;
            background: var(--google);
            color: var(--white);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
        }
        
        .google-btn:active {
            transform: scale(0.98);
        }
        
        .google-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .google-icon {
            width: 18px;
            height: 18px;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: var(--google);
        }
        
        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: var(--gray);
            font-size: 13px;
        }
        
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--gray);
            opacity: 0.3;
        }
        
        .divider span {
            background: var(--dark);
            padding: 0 12px;
            position: relative;
        }
        
        /* –§–æ—Ä–º–∞ */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-light);
        }
        
        .form-input {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid var(--gray);
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: rgba(15, 23, 42, 0.6);
            color: var(--white);
        }
        
        .form-input::placeholder {
            color: var(--gray);
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(15, 23, 42, 0.8);
        }
        
        .btn {
            width: 100%;
            padding: 14px 16px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: var(--gradient);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(0, 242, 254, 0.3);
        }
        
        .btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }
        
        .switch-auth {
            text-align: center;
            margin-top: 20px;
            color: var(--gray);
            font-size: 14px;
        }
        
        .switch-auth a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            padding: 10px 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            text-align: center;
        }
        
        .success-message {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
            padding: 10px 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
            border: 1px solid rgba(34, 197, 94, 0.2);
            text-align: center;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            border-radius: var(--radius);
            padding: 24px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 242, 254, 0.2);
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 8px;
        }
        
        .modal-subtitle {
            color: var(--gray-light);
            font-size: 14px;
        }

        .password-requirements {
            margin-top: 4px;
            font-size: 12px;
            color: var(--gray);
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è iPhone X */
        @media (max-height: 812px) {
            body {
                align-items: flex-start;
                padding-top: 20px;
                padding-bottom: 20px;
            }
            
            .auth-card {
                padding: 20px 16px;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            .card-title {
                font-size: 18px;
                margin-bottom: 16px;
            }
        }

        @media (max-width: 380px) {
            .app-container {
                max-width: 100%;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .logo i {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="logo">
                <i class="fa fa-diamond"></i>
                <span>Zeeptook</span>
            </div>
            <div class="subtitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</div>
        </div>
        
        <div class="auth-card">
            <h1 class="card-title" id="form-title">–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h1>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('login')">–í—Ö–æ–¥</button>
                <button class="tab" onclick="switchTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <div id="error-message" class="error-message" style="display: none;"></div>
            <div id="success-message" class="success-message" style="display: none;"></div>
            
            <!-- Google –∫–Ω–æ–ø–∫–∞ -->
            <button class="google-btn" id="google-auth-btn">
                <div class="google-icon">G</div>
                <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å Google</span>
            </button>
            
            <div class="divider">
                <span>–∏–ª–∏ —á–µ—Ä–µ–∑ email</span>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <form id="login-form" style="display: block;">
                <div class="form-group">
                    <label class="form-label">Email –∏–ª–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" class="form-input" id="login-username" placeholder="–í–≤–µ–¥–∏—Ç–µ email –∏–ª–∏ username" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>
                
                <button type="submit" class="btn btn-primary" id="login-btn">
                    <i class="fa fa-sign-in"></i>
                    <span>–í–æ–π—Ç–∏</span>
                </button>
            </form>
            
            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <form id="register-form" style="display: none;">
                <div class="form-group">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                    <input type="text" class="form-input" id="reg-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ username" required>
                    <div class="password-requirements">–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –Ω–∏–∂–Ω–µ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-input" id="reg-email" placeholder="–í–∞—à email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                    <input type="text" class="form-input" id="reg-full_name" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                    <input type="number" class="form-input" id="reg-birth_year" placeholder="1990" min="1900" max="2024" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å *</label>
                    <input type="password" class="form-input" id="reg-password" placeholder="–ù–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤" minlength="6" required>
                    <div class="password-requirements">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="register-btn">
                    <i class="fa fa-user-plus"></i>
                    <span>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</span>
                </button>
            </form>
            
            <div class="switch-auth">
                <span id="switch-text">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span>
                <a href="#" onclick="switchAuth()" id="switch-link">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ Google Auth -->
    <div id="google-complete-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>
                <p class="modal-subtitle">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ</p>
            </div>
            
            <div id="modal-error-message" class="error-message" style="display: none;"></div>
            
            <form id="google-complete-form">
                <div class="form-group">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                    <input type="text" class="form-input" id="google-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ username" required>
                    <div class="password-requirements">–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –Ω–∏–∂–Ω–µ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                    <input type="number" class="form-input" id="google-birth_year" placeholder="1990" min="1900" max="2024" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å *</label>
                    <input type="password" class="form-input" id="google-password" placeholder="–ù–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤" minlength="6" required>
                    <div class="password-requirements">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="google-complete-btn">
                    <i class="fa fa-check"></i>
                    <span>–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</span>
                </button>
            </form>
        </div>
    </div>

    <script>
    const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : '/api';
    let currentMode = 'login';
    let googleUserData = null;
    let googleClientId = null;
    let googleAuthInitialized = false;
    let googleOAuthState = null;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ OAuth callback –≤ URL
function checkForOAuthCallback() {
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    const state = params.get('state');
    const error = params.get('error');
    
    // –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
    if (code || error) {
        history.replaceState(null, null, window.location.pathname);
    }
    
    if (error) {
        showError('–û—à–∏–±–∫–∞ Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + error);
        return;
    }
    
    if (code && state) {
        const savedState = sessionStorage.getItem('google_oauth_state');
        if (!savedState || !state.startsWith(savedState.split('_')[0])) {
            showError('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
            return;
        }
        
        sessionStorage.removeItem('google_oauth_state');
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º code –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±–º–µ–Ω–∞ –Ω–∞ —Ç–æ–∫–µ–Ω
        handleGoogleAuthorizationCode(code, state);
    }
}

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
async function handleGoogleAuthorizationCode(code, state) {
    try {
        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ state
        const stateParts = state.split('_');
        const clientType = stateParts[stateParts.length - 1] || 'web';
        
        console.log(`üîê –û–±—Ä–∞–±–æ—Ç–∫–∞ Google –∫–æ–¥–∞ –¥–ª—è ${clientType} –∫–ª–∏–µ–Ω—Ç–∞`);
        
        showSuccess('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Google...');
        
        const response = await fetch(`${API_BASE}/auth/google`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                code: code,
                clientType: clientType
            })
        });

        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.error || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google');
        }
        
        if (data.success && data.exists) {
            saveUserAndRedirect(data);
        } else if (data.success && !data.exists) {
            googleUserData = data.user;
            showGoogleCompleteModal();
        } else {
            throw new Error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Google –∫–æ–¥–∞:', error);
        showError(error.message || '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö Google');
    }
}

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    function checkExistingAuth() {
        const token = localStorage.getItem('token');
        if (token) {
            window.location.href = 'profile.html';
        }
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
    function switchTab(tab) {
        const loginTab = document.querySelector('.tab:nth-child(1)');
        const registerTab = document.querySelector('.tab:nth-child(2)');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const formTitle = document.getElementById('form-title');
        
        if (tab === 'login') {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
            formTitle.textContent = '–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç';
            currentMode = 'login';
            updateSwitchText();
        } else {
            loginTab.classList.remove('active');
            registerTab.classList.add('active');
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            formTitle.textContent = '–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç';
            currentMode = 'register';
            updateSwitchText();
        }
        
        // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
        hideMessages();
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤—Ö–æ–¥–æ–º –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
    function switchAuth() {
        if (currentMode === 'login') {
            switchTab('register');
        } else {
            switchTab('login');
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
    function updateSwitchText() {
        const switchText = document.getElementById('switch-text');
        const switchLink = document.getElementById('switch-link');
        
        if (currentMode === 'login') {
            switchText.textContent = '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?';
            switchLink.textContent = '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
        } else {
            switchText.textContent = '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?';
            switchLink.textContent = '–í–æ–π—Ç–∏';
        }
    }

    // –í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç
    async function handleLogin(event) {
        event.preventDefault();
        
        const submitBtn = document.getElementById('login-btn');
        const btnText = submitBtn.querySelector('span');
        const btnIcon = submitBtn.querySelector('i');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        hideMessages();
        
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!username || !password) {
            showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            return;
        }
        
        try {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            btnText.textContent = '–í—Ö–æ–¥...';
            btnIcon.className = 'fa fa-spinner fa-spin';
            submitBtn.disabled = true;
            
            const response = await fetch(`${API_BASE}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: username,
                    password: password
                })
            });

            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            localStorage.setItem('token', data.token);
            localStorage.setItem('user', JSON.stringify(data.user));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º
            showSuccess('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');
            
            setTimeout(() => {
                window.location.href = 'profile.html';
            }, 1000);
            
        } catch (error) {
            console.error('Login error:', error);
            showError(error.message);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            btnText.textContent = '–í–æ–π—Ç–∏';
            btnIcon.className = 'fa fa-sign-in';
            submitBtn.disabled = false;
        }
    }

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ email
    async function handleRegister(event) {
        event.preventDefault();
        
        const submitBtn = document.getElementById('register-btn');
        const btnText = submitBtn.querySelector('span');
        const btnIcon = submitBtn.querySelector('i');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        hideMessages();
        
        const username = document.getElementById('reg-username').value.trim();
        const email = document.getElementById('reg-email').value.trim();
        const fullName = document.getElementById('reg-full_name').value.trim();
        const birthYear = parseInt(document.getElementById('reg-birth_year').value);
        const password = document.getElementById('reg-password').value;

        if (isNaN(birthYear)) {
    showError('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è');
    return;
}
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!username || !email || !fullName || !birthYear || !password) {
            showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ username
        if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            showError('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è');
            return;
        }
        
        if (password.length < 6) {
            showError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤');
            return;
        }
        
        try {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            btnText.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
            btnIcon.className = 'fa fa-spinner fa-spin';
            submitBtn.disabled = true;
            
            const response = await fetch(`${API_BASE}/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: username,
                    email: email,
                    password: password,
                    full_name: fullName,
                    auth_method: 'email'
                })
            });

            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            localStorage.setItem('token', data.token);
            localStorage.setItem('user', JSON.stringify(data.user));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º
            showSuccess('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');
            
            setTimeout(() => {
                window.location.href = 'profile.html';
            }, 1500);
            
        } catch (error) {
            console.error('Registration error:', error);
            showError(error.message);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            btnText.textContent = '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
            btnIcon.className = 'fa fa-user-plus';
            submitBtn.disabled = false;
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Google —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–∞
async function loadGoogleConfig() {
    try {
        console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Google...');
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞ (–≤–µ–±-—Å–∞–π—Ç –∏–ª–∏ –≤–µ–±–≤—å—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
        const isApp = /(Android|iPhone|iPad|iPod|Mobile)/i.test(navigator.userAgent) && 
                     /WebView|wv|CriOS|FxiOS/.test(navigator.userAgent);
        
        const clientType = isApp ? 'app' : 'web';
        console.log(`üì± –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞: ${clientType} (User-Agent: ${navigator.userAgent})`);
        
        const response = await fetch(`${API_BASE}/config/google?clientType=${clientType}`);
        
        if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏');
        }
        
        const config = await response.json();
        
        if (config.success && config.googleClientId && config.googleClientId !== 'not-configured') {
            googleClientId = config.googleClientId;
            console.log(`‚úÖ ${clientType.toUpperCase()} Google Client ID –ø–æ–ª—É—á–µ–Ω:`, googleClientId?.slice(-8));
            
            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É Google
            const googleBtn = document.getElementById('google-auth-btn');
            googleBtn.disabled = false;
            googleAuthInitialized = true;
            
        } else {
            console.warn(`Google OAuth –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è ${clientType} –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ`);
            disableGoogleButton();
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Google:', error);
        disableGoogleButton();
    }
}

    // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ Google
    function disableGoogleButton() {
        const googleBtn = document.getElementById('google-auth-btn');
        googleBtn.innerHTML = '<i class="fa fa-exclamation-triangle"></i> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ email —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é';
        googleBtn.disabled = true;
        googleBtn.style.opacity = '0.6';
    }

    // Google OAuth —á–µ—Ä–µ–∑ redirect
function handleGoogleRedirectAuth() {
    if (!googleAuthInitialized || !googleClientId) {
        showError('Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ email.');
        return;
    }

    try {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞
        const isApp = /(Android|iPhone|iPad|iPod|Mobile)/i.test(navigator.userAgent) && 
                     /WebView|wv|CriOS|FxiOS/.test(navigator.userAgent);
        const clientType = isApp ? 'app' : 'web';
        
        console.log(`üîê –ó–∞–ø—É—Å–∫ Google OAuth –¥–ª—è ${clientType} –∫–ª–∏–µ–Ω—Ç–∞`);
        
        // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π state –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF
        googleOAuthState = 'google_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9) + '_' + clientType;
        sessionStorage.setItem('google_oauth_state', googleOAuthState);
        
        // –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º SAME PAGE –¥–ª—è callback
        const redirectUri = encodeURIComponent(window.location.origin + window.location.pathname);
        const scope = encodeURIComponent('email profile openid');
        const responseType = 'code'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º Authorization Code Flow
        
        // –î–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?` +
            `client_id=${googleClientId}` +
            `&redirect_uri=${redirectUri}` +
            `&response_type=${responseType}` +
            `&scope=${scope}` +
            `&state=${googleOAuthState}` +
            `&prompt=select_account` +
            (clientType === 'app' ? '&access_type=offline&include_granted_scopes=true' : '');
        
        console.log(`–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Google OAuth –¥–ª—è ${clientType}...`);
        
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        window.location.href = authUrl;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
        showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
    }
}

    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å
    async function saveUserAndRedirect(data) {
        try {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            localStorage.setItem('token', data.token);
            localStorage.setItem('user', JSON.stringify(data.user));

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º
            showSuccess('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');
            
            setTimeout(() => {
                window.location.href = 'profile.html';
            }, 1000);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            showError('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google
    function showGoogleCompleteModal() {
        const modal = document.getElementById('google-complete-modal');
        modal.style.display = 'flex';
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ email
        const email = googleUserData.email;
        const usernameBase = email.split('@')[0].replace(/[^a-zA-Z0-9]/g, '_');
        document.getElementById('google-username').value = usernameBase;
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const currentYear = new Date().getFullYear();
        document.getElementById('google-birth_year').value = currentYear - 25;
        
        // –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫–∏
        document.getElementById('modal-error-message').style.display = 'none';
        
        // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–æ–ª–µ
        document.getElementById('google-username').focus();
    }

    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google
    async function handleGoogleComplete(event) {
        event.preventDefault();
        
        const submitBtn = document.getElementById('google-complete-btn');
        const btnText = submitBtn.querySelector('span');
        const btnIcon = submitBtn.querySelector('i');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        document.getElementById('modal-error-message').style.display = 'none';
        
        const username = document.getElementById('google-username').value.trim();
        const birthYear = parseInt(document.getElementById('google-birth_year').value);
        const password = document.getElementById('google-password').value;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!username || !birthYear || !password) {
            showModalError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ username
        if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            showModalError('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è');
            return;
        }
        
        if (password.length < 6) {
            showModalError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤');
            return;
        }
        
        const currentYear = new Date().getFullYear();
        if (birthYear < 1900 || birthYear > currentYear) {
            showModalError('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è');
            return;
        }
        
        try {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            btnText.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
            btnIcon.className = 'fa fa-spinner fa-spin';
            submitBtn.disabled = true;
            
            const response = await fetch(`${API_BASE}/auth/google/complete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    google_id: googleUserData.google_id,
                    email: googleUserData.email,
                    full_name: googleUserData.full_name,
                    username: username,
                    password: password,
                    birth_year: birthYear,
                    avatar_url: googleUserData.avatar_url || '',
                    auth_method: 'google'
                })
            });

            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            localStorage.setItem('token', data.token);
            localStorage.setItem('user', JSON.stringify(data.user));
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('google-complete-modal').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º
            showSuccess('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');
            
            setTimeout(() => {
                window.location.href = 'profile.html';
            }, 1500);
            
        } catch (error) {
            console.error('Google complete registration error:', error);
            showModalError(error.message);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            btnText.textContent = '–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é';
            btnIcon.className = 'fa fa-check';
            submitBtn.disabled = false;
        }
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function hideMessages() {
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('success-message').style.display = 'none';
    }

    function showError(message) {
        const errorDiv = document.getElementById('error-message');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        
        // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            errorDiv.style.display = 'none';
        }, 5000);
    }

    function showSuccess(message) {
        const successDiv = document.getElementById('success-message');
        successDiv.textContent = message;
        successDiv.style.display = 'block';
        
        // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            successDiv.style.display = 'none';
        }, 3000);
    }

    function showModalError(message) {
        const errorDiv = document.getElementById('modal-error-message');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º OAuth callback (—ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ü–ï–†–í–û–ô –æ–ø–µ—Ä–∞—Ü–∏–µ–π)
        checkForOAuthCallback();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        checkExistingAuth();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Google
        loadGoogleConfig();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
        document.getElementById('login-form').addEventListener('submit', handleLogin);
        document.getElementById('register-form').addEventListener('submit', handleRegister);
        document.getElementById('google-complete-form').addEventListener('submit', handleGoogleComplete);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ Google
        document.getElementById('google-auth-btn').addEventListener('click', handleGoogleRedirectAuth);
        
        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–æ–¥–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
        const currentYear = new Date().getFullYear();
        document.getElementById('reg-birth_year').value = currentYear - 25;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è username –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        document.getElementById('reg-username').addEventListener('input', function(e) {
            const value = e.target.value;
            if (!/^[a-zA-Z0-9_]*$/.test(value)) {
                e.target.value = value.replace(/[^a-zA-Z0-9_]/g, '');
            }
        });
        
        document.getElementById('google-username').addEventListener('input', function(e) {
            const value = e.target.value;
            if (!/^[a-zA-Z0-9_]*$/.test(value)) {
                e.target.value = value.replace(/[^a-zA-Z0-9_]/g, '');
            }
        });
    });
</script>
</body>
</html>
