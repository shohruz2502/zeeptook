<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zeeptook - –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
    /* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        -webkit-tap-highlight-color: transparent;
    }
    
    :root {
        --primary: #0088cc;
        --primary-dark: #0077b3;
        --secondary: #18222d;
        --accent: #ff6b6b;
        --gray-dark: #2a2f36;
        --gray-medium: #3c4350;
        --gray-light: #8e98a3;
        --white: #ffffff;
        --message-out: #2b5278;
        --message-in: #182533;
        --chat-bg: #0e1621;
        --input-bg: #242f3d;
        --nav-bg: #17212b;
        --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        --shadow: 0 1px 3px rgba(0,0,0,0.3);
        --radius: 12px;
        --radius-sm: 8px;
        --radius-xs: 6px;
    }
    
    html, body {
        height: 100%;
        overflow-x: hidden;
        background: var(--chat-bg);
        color: var(--white);
    }
    
    body {
        font-size: 15px;
        opacity: 0;
        animation: pageFadeIn 0.4s ease forwards;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        padding: 0;
        margin: 0;
        max-width: 768px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ */
        margin: 0 auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
        width: 100%;
        box-shadow: 0 0 20px rgba(0,0,0,0.3); /* –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ü–ö */
    }

    @keyframes pageFadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .app-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        width: 100%;
        position: relative;
    }

    /* Header */
    .header {
        background: var(--nav-bg);
        color: var(--white);
        padding: 12px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        height: 60px;
        border-bottom: 1px solid var(--gray-dark);
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    
    .logo {
        font-size: 18px;
        font-weight: 600;
        color: var(--white);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .logo i {
        color: var(--primary);
        font-size: 20px;
    }
    
    .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .messages-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: var(--gradient);
        color: var(--white);
        border: none;
        border-radius: 50%;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(0, 136, 204, 0.3);
    }
    
    .messages-btn:active {
        transform: scale(0.95);
        background: linear-gradient(135deg, var(--primary-dark) 0%, #006699 100%);
    }
    
    .messages-btn i {
        font-size: 18px;
    }

    /* Main Content Area */
    .content-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-top: 60px; /* –í—ã—Å–æ—Ç–∞ header */
        margin-bottom: 60px; /* –í—ã—Å–æ—Ç–∞ bottom-nav */
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Search Section - –ù–ê –í–ï–†–•–£ */
    .search-section {
        padding: 12px 16px;
        background: var(--nav-bg);
        border-bottom: 1px solid var(--gray-dark);
        position: sticky;
        top: 60px; /* –ü–æ–¥ header */
        z-index: 999;
    }
    
    .search-container {
        position: relative;
    }
    
    .search-box {
        display: flex;
        width: 100%;
        border-radius: 21px;
        overflow: hidden;
        background: var(--input-bg);
        border: 1px solid var(--gray-dark);
        transition: all 0.2s ease;
    }
    
    .search-box:focus-within {
        border-color: var(--primary);
    }
    
    .search-box input {
        flex-grow: 1;
        padding: 12px 16px;
        border: none;
        background: transparent;
        font-size: 15px;
        outline: none;
        color: var(--white);
    }
    
    .search-box input::placeholder {
        color: var(--gray-light);
        font-size: 14px;
    }
    
    .search-box button {
        background: transparent;
        color: var(--gray-light);
        border: none;
        padding: 0 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        min-width: 46px;
    }
    
    .search-box button:active {
        transform: scale(0.95);
    }

    /* Categories - –ü–û–î –ü–û–ò–°–ö–û–ú */
    .categories-section {
        background: var(--nav-bg);
        border-bottom: 1px solid var(--gray-dark);
        position: sticky;
        z-index: 998;
        top: 124px; /* –ü–æ–¥ header + search */
    }
    
    .categories-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        padding: 12px 16px;
    }
    
    .category {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 5px;
        background: var(--input-bg);
        border-radius: var(--radius-sm);
        font-size: 12px;
        font-weight: 500;
        transition: all 0.2s ease;
        border: 1px solid var(--gray-dark);
        cursor: pointer;
        color: var(--gray-light);
        text-align: center;
        min-height: 70px;
    }
    
    .category i {
        font-size: 20px;
        margin-bottom: 6px;
        color: var(--primary);
    }
    
    .category.active {
        background: var(--gradient);
        color: white;
        border-color: var(--primary);
    }
    
    .category.active i {
        color: white;
    }
    
    .category:active {
        transform: scale(0.95);
    }

    /* Main Content */
    .main-content {
        flex: 1;
        padding: 0;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Section Header - –£–ü–†–û–©–ï–ù–ù–´–ô */
    .section-header {
        padding: 12px 16px;
        background: var(--nav-bg);
        border-bottom: 1px solid var(--gray-dark);
    }
    
    .section-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--white);
    }

    /* Ads Grid */
    .ads-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        padding: 12px;
        background: var(--chat-bg);
        min-height: 200px;
    }

    /* Ad Card - –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô */
    .ad-card {
        background: var(--nav-bg);
        border-radius: var(--radius);
        overflow: hidden;
        cursor: pointer;
        border: 1px solid var(--gray-dark);
        display: flex;
        flex-direction: column;
        opacity: 0;
        transform: translateY(10px);
        animation: cardAppear 0.3s ease-out forwards;
    }
    
    @keyframes cardAppear {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .ad-card:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }
    
    /* Ad Image - –õ–ï–ù–ò–í–ê–Ø –ó–ê–ì–†–£–ó–ö–ê */
    .ad-image {
        position: relative;
        width: 100%;
        height: 150px;
        background: linear-gradient(135deg, #1c2836 0%, #2a2f36 100%);
        overflow: hidden;
        border-radius: var(--radius) var(--radius) 0 0;
    }
    
    .ad-image-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.3s ease;
        border-radius: var(--radius) var(--radius) 0 0;
        opacity: 0;
    }
    
    .ad-image-img.loaded {
        opacity: 1;
    }
    
    .ad-image-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--gray-light);
        gap: 8px;
        background: linear-gradient(135deg, #1c2836 0%, #2a2f36 100%);
        border-radius: var(--radius) var(--radius) 0 0;
    }
    
    .ad-image-placeholder i {
        font-size: 28px;
        opacity: 0.5;
    }
    
    .ad-image-placeholder span {
        font-size: 12px;
        opacity: 0.7;
    }
    
    .ad-content {
        padding: 12px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .ad-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    
    .ad-category {
        font-size: 11px;
        background: rgba(0, 136, 204, 0.15);
        padding: 4px 8px;
        border-radius: 10px;
        color: var(--primary);
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 70%;
    }
    
    .ad-favorite {
        color: var(--gray-light);
        background: transparent;
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
        flex-shrink: 0;
    }
    
    .ad-favorite.active {
        color: var(--accent);
    }
    
    .ad-favorite:active {
        transform: scale(0.9);
        background: rgba(255, 255, 255, 0.1);
    }
    
    .ad-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 6px;
        color: var(--white);
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: 36px;
    }
    
    .ad-description {
        color: var(--gray-light);
        margin-bottom: 10px;
        font-size: 12px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex: 1;
    }
    
    .ad-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
    }
    
    .ad-price {
        font-weight: 700;
        color: var(--primary);
        font-size: 15px;
    }
    
    .ad-meta {
        font-size: 11px;
        color: var(--gray-light);
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .ad-meta i {
        font-size: 10px;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: var(--nav-bg);
        margin: 12px;
        border-radius: var(--radius);
        border: 1px solid var(--gray-dark);
        grid-column: 1 / -1;
    }
    
    .empty-state i {
        font-size: 48px;
        color: var(--gray-light);
        margin-bottom: 20px;
        opacity: 0.6;
    }
    
    .empty-state h3 {
        font-size: 18px;
        margin-bottom: 10px;
        color: var(--white);
        font-weight: 500;
    }
    
    .empty-state p {
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 25px;
        max-width: 280px;
        margin-left: auto;
        margin-right: auto;
        color: var(--gray-light);
    }

    /* Loading */
    .initial-loading {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-light);
        grid-column: 1 / -1;
    }
    
    .loading-spinner {
        width: 30px;
        height: 30px;
        border: 2px solid rgba(0, 136, 204, 0.2);
        border-top: 2px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
    }

    /* Load More Button */
    .load-more {
        text-align: center;
        padding: 20px 16px;
        background: var(--chat-bg);
        grid-column: 1 / -1;
    }
    
    .load-more-btn {
        padding: 12px 24px;
        border: 1px solid var(--primary);
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        background: transparent;
        color: var(--primary);
        width: 100%;
        max-width: 200px;
    }
    
    .load-more-btn:active {
        transform: scale(0.97);
        background: rgba(0, 136, 204, 0.1);
    }
    
    .load-more-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }

    /* Error State */
    .error-state {
        text-align: center;
        padding: 40px 20px;
        background: var(--nav-bg);
        margin: 12px;
        border-radius: var(--radius);
        border: 1px solid var(--gray-dark);
        grid-column: 1 / -1;
    }
    
    .error-state i {
        font-size: 48px;
        color: var(--accent);
        margin-bottom: 15px;
        opacity: 0.7;
    }
    
    .error-state h3 {
        font-size: 18px;
        margin-bottom: 10px;
        color: var(--white);
        font-weight: 500;
    }
    
    .error-state p {
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 20px;
        color: var(--gray-light);
    }
    
    .retry-btn {
        padding: 12px 20px;
        border: 1px solid var(--primary);
        border-radius: 25px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        background: transparent;
        color: var(--primary);
        width: 100%;
        max-width: 200px;
    }
    
    .retry-btn:active {
        transform: scale(0.97);
        background: rgba(0, 136, 204, 0.1);
    }

    /* Bottom Navigation */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--nav-bg);
        display: flex;
        justify-content: space-around;
        padding: 8px 0 10px;
        border-top: 1px solid var(--gray-dark);
        z-index: 1000;
        height: 60px;
        box-shadow: 0 -1px 3px rgba(0,0,0,0.2);
    }
    
    .nav-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: var(--gray-light);
        font-size: 10px;
        padding: 6px 4px;
        transition: all 0.2s ease;
        flex: 1;
        position: relative;
        border: none;
        background: none;
        cursor: pointer;
    }
    
    .nav-btn i {
        font-size: 20px;
        margin-bottom: 2px;
        transition: all 0.2s ease;
    }
    
    .nav-btn.active {
        color: var(--primary);
    }
    
    .nav-btn.active i {
        transform: translateY(-1px);
    }
    
    .nav-btn.active::after {
        content: '';
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 30px;
        height: 3px;
        background: var(--primary);
        border-radius: 2px;
    }
    
    .nav-btn:active {
        transform: scale(0.95);
    }

    /* Animations */
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 480px) {
        .categories-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            padding: 10px 12px;
        }
        
        .category {
            padding: 8px 4px;
            font-size: 11px;
            min-height: 65px;
        }
        
        .category i {
            font-size: 18px;
        }
        
        .ad-image {
            height: 130px;
        }
    }
    
    @media (min-width: 481px) and (max-width: 768px) {
        .categories-grid {
            grid-template-columns: repeat(5, 1fr);
        }
        
        .ads-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    @media (min-width: 769px) {
        body {
            border-left: 1px solid var(--gray-dark);
            border-right: 1px solid var(--gray-dark);
        }
    }

    /* –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
    .ad-card, .category, .nav-btn, .messages-btn {
        will-change: transform;
        backface-visibility: hidden;
    }

    /* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
    html {
        scroll-behavior: smooth;
    }

    /* –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ */
    .content-wrapper, .main-content {
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    
    .content-wrapper::-webkit-scrollbar,
    .main-content::-webkit-scrollbar {
        display: none;
    }
</style>
</head>
<body>
    <div class="app-container">
        <!-- –•–ï–î–ï–† -->
        <div class="header">
            <div class="logo">
                <i class="fa fa-diamond"></i>
                <span>Zeeptook</span>
            </div>
            <div class="header-actions">
                <a href="messages.html" class="messages-btn">
                    <i class="fa fa-comment"></i>
                </a>
            </div>
        </div>
        
        <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
        <div class="content-wrapper">
            <!-- –ü–û–ò–°–ö - –°–í–ï–†–•–£ -->
            <div class="search-section">
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥...">
                        <button id="search-btn">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –ö–ê–¢–ï–ì–û–†–ò–ò - –ü–û–î –ü–û–ò–°–ö–û–ú -->
            <div class="categories-section">
                <div class="categories-grid" id="categories-container">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </div>
            </div>
            
            <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
            <div class="main-content">
                <div class="section-header">
                    <div class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</div>
                </div>
                
                <div class="ads-grid" id="ads-container">
                    <div class="initial-loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                
                <div class="load-more">
                    <button class="load-more-btn" id="load-more-btn" style="display: none;">–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë</button>
                </div>
            </div>
        </div>
        
        <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
        <div class="bottom-nav">
            <a href="index.html" class="nav-btn active">
                <i class="fa fa-home"></i>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </a>
            <a href="favorites.html" class="nav-btn">
                <i class="fa fa-heart"></i>
                <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </a>
            <a href="add-ad.html" class="nav-btn">
                <i class="fa fa-plus"></i>
                <span>–î–æ–±–∞–≤–∏—Ç—å</span>
            </a>
            <a href="server-page.html" class="nav-btn">
                <i class="fa fa-gamepad"></i>
                <span>–°–µ—Ä–≤–µ—Ä—ã</span>
            </a>
            <a href="profile.html" class="nav-btn">
                <i class="fa fa-user"></i>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </a>
        </div>
    </div>

    <script>
        // –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –í–ï–†–°–ò–Ø - –ë–´–°–¢–†–ê–Ø –ó–ê–ì–†–£–ó–ö–ê
        let currentPage = 1;
        let totalPages = 1;
        let currentCategory = 'all';
        let currentSearch = '';
        let isLoading = false;
        let isInitialLoad = true;
        let ads = [];
        const API_BASE = '/api';
        const IMAGE_BATCH_SIZE = 2; // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ 2 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞ —Ä–∞–∑
        let imageLoadQueue = [];
        let isProcessingImages = false;

        // –ö—ç—à –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        const imageCache = new Map();

        // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        const defaultCategories = [
            { name: '–í—Å–µ', icon: 'fa-th-large', data: 'all' },
            { name: '–ò–≥—Ä—ã', icon: 'fa-gamepad', data: 'games' },
            { name: '–ê–∫–∫–∞—É–Ω—Ç—ã', icon: 'fa-user', data: 'accounts' },
            { name: '–ì–∞–¥–∂–µ—Ç—ã', icon: 'fa-mobile', data: 'gadgets' },
            { name: '–ö–ª—é—á–∏', icon: 'fa-key', data: 'keys' },
            { name: '–°–∫–∏–Ω—ã', icon: 'fa-paint-brush', data: 'skins' },
            { name: '–£—Å–ª—É–≥–∏', icon: 'fa-cogs', data: 'services' },
            { name: '–î—Ä—É–≥–æ–µ', icon: 'fa-ellipsis-h', data: 'other' }
        ];

        // –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function loadCategoriesFast() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';
            
            defaultCategories.forEach(cat => {
                const categoryElement = document.createElement('div');
                categoryElement.className = cat.data === 'all' ? 'category active' : 'category';
                categoryElement.innerHTML = `<i class="fa ${cat.icon}"></i><span>${cat.name}</span>`;
                categoryElement.setAttribute('data-category', cat.data);
                container.appendChild(categoryElement);
            });
            
            setupCategories();
        }

        // –°—É–ø–µ—Ä-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        async function fetchAdsOptimized(page = 1, category = 'all', search = '') {
            if (isLoading) return;
            
            isLoading = true;
            const adsContainer = document.getElementById('ads-container');
            const loadMoreBtn = document.getElementById('load-more-btn');
            
            try {
                // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                if (page === 1 && isInitialLoad) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
                    const existingAds = adsContainer.querySelectorAll('.ad-card');
                    if (existingAds.length === 0) {
                        adsContainer.innerHTML = `
                            <div class="initial-loading">
                                <div class="loading-spinner"></div>
                                <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                            </div>
                        `;
                    }
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º URL
                let url = `${API_BASE}/ads?page=${page}&limit=12`;
                if (category !== 'all') url += `&category=${encodeURIComponent(category)}`;
                if (search) url += `&search=${encodeURIComponent(search)}`;

                const options = { method: 'GET' };
                const token = localStorage.getItem('token');
                if (token) options.headers = { 'Authorization': `Bearer ${token}` };

                // Fetch —Å —Ç–∞–π–º–∞—É—Ç–æ–º
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000);
                options.signal = controller.signal;

                const response = await fetch(url, options);
                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                if (page === 1) {
                    ads = data.ads;
                } else {
                    ads = [...ads, ...data.ads];
                }
                
                currentPage = data.page;
                totalPages = data.totalPages;
                
                // –ú–ì–ù–û–í–ï–ù–ù–û –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ë–ï–ó –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                displayAdsFast(data.ads, page === 1);
                
                // –ü–æ—Ç–æ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≥—Ä—É–∑–∏–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                if (data.ads.length > 0) {
                    setTimeout(() => {
                        queueImagesForLoading(data.ads);
                    }, 100);
                }
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π
                if (currentPage < totalPages) {
                    loadMoreBtn.style.display = 'block';
                    loadMoreBtn.disabled = false;
                    loadMoreBtn.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë';
                } else {
                    loadMoreBtn.style.display = 'none';
                }
                
                isInitialLoad = false;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
                if (page === 1 && isInitialLoad) {
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è');
                }
            } finally {
                isLoading = false;
                adsContainer.classList.remove('loading');
            }
        }

        // –ë—ã—Å—Ç—Ä–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
        function displayAdsFast(adsToDisplay, clearContainer = true) {
            const adsContainer = document.getElementById('ads-container');
            
            if (clearContainer) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
                const existingAds = adsContainer.querySelectorAll('.ad-card[data-ad-id]');
                if (existingAds.length > 0 && !clearContainer) return;
                
                adsContainer.innerHTML = '';
            }
            
            if (adsToDisplay.length === 0 && clearContainer) {
                adsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fa fa-inbox"></i>
                        <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫</p>
                    </div>
                `;
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –±—ã—Å—Ç—Ä–æ
            const fragment = document.createDocumentFragment();
            
            adsToDisplay.forEach((ad, index) => {
                const adElement = createFastAdCard(ad, index);
                fragment.appendChild(adElement);
                
                // –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
                adElement.style.animationDelay = `${index * 0.05}s`;
            });
            
            adsContainer.appendChild(fragment);
        }

        // –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        function createFastAdCard(ad, index) {
            const adElement = document.createElement('div');
            adElement.className = 'ad-card';
            adElement.setAttribute('data-ad-id', ad.id);
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
            const priceFormatted = ad.price ? 
                new Intl.NumberFormat('ru-RU').format(ad.price) + ' ‚ÇΩ' : 
                '–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è';
            
            const timeAgo = formatTimeAgoFast(ad.created_at);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const isFavorite = favorites.some(fav => fav.id === ad.id);
            
            // HTML –ë–ï–ó –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            adElement.innerHTML = `
                <div class="ad-image" data-ad-id="${ad.id}">
                    <div class="ad-image-placeholder">
                        <i class="fa fa-image"></i>
                        <span>–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
                <div class="ad-content">
                    <div class="ad-header">
                        <div class="ad-category">${ad.category || '–¢–æ–≤–∞—Ä'}</div>
                        <button class="ad-favorite ${isFavorite ? 'active' : ''}" data-ad-id="${ad.id}">
                            <i class="fa fa-heart"></i>
                        </button>
                    </div>
                    <div class="ad-title">${ad.title || '–û–±—ä—è–≤–ª–µ–Ω–∏–µ'}</div>
                    <div class="ad-description">${ad.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                    <div class="ad-footer">
                        <div class="ad-price">${priceFormatted}</div>
                        <div class="ad-meta">
                            <span>${timeAgo}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // –ë—ã—Å—Ç—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            const favoriteBtn = adElement.querySelector('.ad-favorite');
            favoriteBtn.onclick = (e) => {
                e.stopPropagation();
                toggleFavoriteFast(ad.id, favoriteBtn, ad);
            };
            
            adElement.onclick = () => {
                window.location.href = `ad-details.html?id=${ad.id}`;
            };
            
            return adElement;
        }

        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function queueImagesForLoading(adsToLoad) {
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é –æ—á–µ—Ä–µ–¥—å
            imageLoadQueue = [];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
            adsToLoad.forEach(ad => {
                const imageContainer = document.querySelector(`.ad-image[data-ad-id="${ad.id}"]`);
                if (imageContainer) {
                    imageLoadQueue.push({
                        adId: ad.id,
                        ad: ad,
                        container: imageContainer
                    });
                }
            });
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É, –µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
            if (!isProcessingImages) {
                processImageQueueOptimized();
            }
        }

        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        async function processImageQueueOptimized() {
            if (imageLoadQueue.length === 0 || isProcessingImages) return;
            
            isProcessingImages = true;
            
            // –ë–µ—Ä–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø–∞—Ä—Ç–∏—é
            const batch = imageLoadQueue.splice(0, IMAGE_BATCH_SIZE);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
            const promises = batch.map(item => loadImageOptimized(item));
            await Promise.all(promises);
            
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
            setTimeout(() => {
                isProcessingImages = false;
                if (imageLoadQueue.length > 0) {
                    processImageQueueOptimized();
                }
            }, 300);
        }

        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        async function loadImageOptimized({ adId, ad, container }) {
            const placeholder = container.querySelector('.ad-image-placeholder');
            
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const imageUrl = getImageUrlFast(ad);
            if (!imageUrl) {
                if (placeholder) {
                    placeholder.querySelector('span').textContent = '–ù–µ—Ç —Ñ–æ—Ç–æ';
                }
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
            if (imageCache.has(imageUrl)) {
                applyCachedImage(container, imageCache.get(imageUrl));
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å —Ç–∞–π–º–∞—É—Ç–æ–º
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(imageUrl, { 
                    signal: controller.signal,
                    mode: 'cors'
                });
                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error('Image load failed');
                
                // –°–æ–∑–¥–∞–µ–º blob URL –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
                const blob = await response.blob();
                const objectUrl = URL.createObjectURL(blob);
                
                // –ö—ç—à–∏—Ä—É–µ–º
                imageCache.set(imageUrl, objectUrl);
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º
                applyCachedImage(container, objectUrl);
                
            } catch (error) {
                if (placeholder) {
                    placeholder.querySelector('span').textContent = '–û—à–∏–±–∫–∞';
                }
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function applyCachedImage(container, imageUrl) {
            const img = new Image();
            img.onload = () => {
                container.innerHTML = '';
                const imgElement = document.createElement('img');
                imgElement.className = 'ad-image-img';
                imgElement.src = imageUrl;
                imgElement.alt = '';
                imgElement.loading = 'lazy';
                container.appendChild(imgElement);
                
                // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
                setTimeout(() => {
                    imgElement.classList.add('loaded');
                }, 50);
            };
            img.src = imageUrl;
        }

        // –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function getImageUrlFast(ad) {
            if (ad.photos && ad.photos.length > 0) {
                const photo = ad.photos[0];
                if (photo.image_data) {
                    if (photo.image_data.startsWith('http')) {
                        return photo.image_data;
                    } else if (photo.image_data.startsWith('data:image')) {
                        return photo.image_data;
                    }
                }
            }
            if (ad.image && (ad.image.startsWith('http') || ad.image.startsWith('data:image'))) {
                return ad.image;
            }
            return null;
        }

        // –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        function toggleFavoriteFast(adId, favoriteBtn, ad) {
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            if (favoriteBtn.classList.contains('active')) {
                favorites = favorites.filter(fav => fav.id !== adId);
                favoriteBtn.classList.remove('active');
                showQuickNotification('–£–¥–∞–ª–µ–Ω–æ');
            } else {
                const favoriteAd = {
                    id: ad.id,
                    title: ad.title,
                    price: ad.price,
                    category: ad.category
                };
                favorites.push(favoriteAd);
                favoriteBtn.classList.add('active');
                showQuickNotification('–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        // –ë—ã—Å—Ç—Ä–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatTimeAgoFast(dateString) {
            try {
                const now = Date.now();
                const date = new Date(dateString).getTime();
                const diff = now - date;
                
                if (diff < 3600000) return `${Math.floor(diff / 60000)} –º–∏–Ω`;
                if (diff < 86400000) return `${Math.floor(diff / 3600000)} —á`;
                if (diff < 604800000) return `${Math.floor(diff / 86400000)} –¥`;
                return '> –Ω–µ–¥';
            } catch {
                return '–Ω–µ–¥–∞–≤–Ω–æ';
            }
        }

        // –ë—ã—Å—Ç—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showQuickNotification(message) {
            const existing = document.querySelector('.quick-notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'quick-notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 70px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--primary);
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 14px;
                z-index: 10000;
                animation: slideDown 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞
        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            
            const performSearch = () => {
                currentSearch = searchInput.value.trim();
                currentPage = 1;
                fetchAdsOptimized(1, currentCategory, currentSearch);
            };
            
            searchBtn.onclick = performSearch;
            searchInput.onkeypress = (e) => e.key === 'Enter' && performSearch();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function setupCategories() {
            const categories = document.querySelectorAll('.category');
            categories.forEach(cat => {
                cat.onclick = function() {
                    categories.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentCategory = this.getAttribute('data-category');
                    currentPage = 1;
                    fetchAdsOptimized(1, currentCategory, currentSearch);
                };
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const adsContainer = document.getElementById('ads-container');
            adsContainer.innerHTML = `
                <div class="error-state">
                    <i class="fa fa-exclamation-triangle"></i>
                    <p>${message}</p>
                    <button class="retry-btn" onclick="fetchAdsOptimized(1, currentCategory, currentSearch)">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                </div>
            `;
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø - –ú–ò–ù–ò–ú–ê–õ–¨–ù–ê–Ø –ò –ë–´–°–¢–†–ê–Ø
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Fast loading...');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateX(-50%) translateY(0); opacity: 1; }
                    to { transform: translateX(-50%) translateY(-20px); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // –ë—ã—Å—Ç—Ä–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            loadCategoriesFast();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–∏—Å–∫
            setupSearch();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è
            fetchAdsOptimized();
            
            // –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ"
            const loadMoreBtn = document.getElementById('load-more-btn');
            if (loadMoreBtn) {
                loadMoreBtn.onclick = () => {
                    fetchAdsOptimized(currentPage + 1, currentCategory, currentSearch);
                };
            }
            
            // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
            window.addEventListener('scroll', () => {
                const scrollBottom = window.innerHeight + window.scrollY >= document.body.offsetHeight - 500;
                if (scrollBottom && !isLoading && currentPage < totalPages) {
                    fetchAdsOptimized(currentPage + 1, currentCategory, currentSearch);
                }
            }, { passive: true });
        });

        // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        window.addEventListener('beforeunload', () => {
            imageCache.forEach(url => URL.revokeObjectURL(url));
        });
    </script>
</body>
</html>
