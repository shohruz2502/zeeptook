<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zeeptook - –ò–≥—Ä–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
    /* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        -webkit-tap-highlight-color: transparent;
    }
    
    :root {
        --primary: #0088cc;
        --primary-dark: #0077b3;
        --secondary: #18222d;
        --accent: #ff6b6b;
        --gray-dark: #2a2f36;
        --gray-medium: #3c4350;
        --gray-light: #8e98a3;
        --white: #ffffff;
        --chat-bg: #0e1621;
        --input-bg: #242f3d;
        --nav-bg: #17212b;
        --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        --radius: 12px;
        --radius-sm: 8px;
    }
    
    html, body {
        height: 100%;
        overflow-x: hidden;
        background: var(--chat-bg);
        color: var(--white);
    }
    
    body {
        font-size: 15px;
        opacity: 0;
        animation: pageFadeIn 0.3s ease forwards;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        padding: 0;
        margin: 0;
        max-width: 768px;
        margin: 0 auto;
        width: 100%;
    }

    @keyframes pageFadeIn {
        to { opacity: 1; }
    }

    .app-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        width: 100%;
        position: relative;
    }

    /* Header */
    .header {
        background: var(--nav-bg);
        color: var(--white);
        padding: 12px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        height: 60px;
        border-bottom: 1px solid var(--gray-dark);
        max-width: 768px;
        margin: 0 auto;
    }
    
    .logo {
        font-size: 18px;
        font-weight: 600;
        color: var(--white);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .logo i {
        color: var(--primary);
        font-size: 20px;
    }
    
    .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .messages-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: var(--gradient);
        color: var(--white);
        border: none;
        border-radius: 50%;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        box-shadow: 0 2px 8px rgba(0, 136, 204, 0.3);
    }
    
    .messages-btn:active {
        transform: scale(0.95);
    }
    
    .messages-btn i {
        font-size: 18px;
    }

    /* Search Section - –°–í–ï–†–•–£ */
    .search-section {
        background: var(--nav-bg);
        border-bottom: 1px solid var(--gray-dark);
        padding: 12px 16px;
        position: sticky;
        top: 60px;
        z-index: 999;
        transition: transform 0.3s ease;
        max-width: 768px;
        margin: 0 auto;
        left: 0;
        right: 0;
    }
    
    .search-container {
        position: relative;
    }
    
    .search-box {
        display: flex;
        width: 100%;
        border-radius: 21px;
        overflow: hidden;
        background: var(--input-bg);
        border: 1px solid var(--gray-dark);
        transition: all 0.2s ease;
    }
    
    .search-box:focus-within {
        border-color: var(--primary);
    }
    
    .search-box input {
        flex-grow: 1;
        padding: 12px 16px;
        border: none;
        background: transparent;
        font-size: 15px;
        outline: none;
        color: var(--white);
    }
    
    .search-box input::placeholder {
        color: var(--gray-light);
        font-size: 14px;
    }
    
    .search-box button {
        background: transparent;
        color: var(--gray-light);
        border: none;
        padding: 0 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        min-width: 46px;
    }
    
    .search-box button:active {
        transform: scale(0.95);
    }

    /* Categories - –ü–û–î –ü–û–ò–°–ö–û–ú –° –ê–ù–ò–ú–ê–¶–ò–ï–ô */
    .categories-section {
        background: var(--nav-bg);
        border-bottom: 1px solid var(--gray-dark);
        position: sticky;
        z-index: 998;
        top: 124px; /* header + search */
        transition: transform 0.3s ease;
        max-width: 768px;
        margin: 0 auto;
        left: 0;
        right: 0;
    }
    
    .categories-scroll {
        display: flex;
        overflow-x: auto;
        padding: 12px 16px;
        gap: 8px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    
    .categories-scroll::-webkit-scrollbar {
        display: none;
    }
    
    .category {
        flex: 0 0 auto;
        padding: 8px 16px;
        background: var(--input-bg);
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
        white-space: nowrap;
        transition: all 0.2s ease;
        border: 1px solid var(--gray-dark);
        cursor: pointer;
        color: var(--gray-light);
    }
    
    .category.active {
        background: var(--gradient);
        color: white;
        border-color: var(--primary);
    }
    
    .category:active {
        transform: scale(0.95);
    }

    /* Main Content Area */
    .content-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-top: 60px;
        margin-bottom: 60px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Main Content */
    .main-content {
        flex: 1;
        padding: 0;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Section Header */
    .section-header {
        padding: 16px 16px 12px;
        background: var(--chat-bg);
    }
    
    .section-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--white);
    }

    /* Ads Grid */
    .ads-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        padding: 0 16px 16px;
        background: var(--chat-bg);
        min-height: 200px;
    }

    /* Ad Card */
    .ad-card {
        background: var(--nav-bg);
        border-radius: var(--radius);
        overflow: hidden;
        cursor: pointer;
        border: 1px solid var(--gray-dark);
        display: flex;
        flex-direction: column;
        opacity: 0;
        transform: translateY(10px);
        animation: cardAppear 0.3s ease-out forwards;
    }
    
    @keyframes cardAppear {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .ad-card:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }
    
    /* Ad Image */
    .ad-image {
        position: relative;
        width: 100%;
        height: 160px;
        background: linear-gradient(135deg, #1c2836 0%, #2a2f36 100%);
        overflow: hidden;
        border-radius: var(--radius) var(--radius) 0 0;
    }
    
    .ad-image-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.3s ease;
        opacity: 0;
    }
    
    .ad-image-img.loaded {
        opacity: 1;
    }
    
    .ad-image-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--gray-light);
        gap: 8px;
        background: linear-gradient(135deg, #1c2836 0%, #2a2f36 100%);
    }
    
    .ad-image-placeholder i {
        font-size: 32px;
        opacity: 0.5;
    }
    
    .ad-image-placeholder span {
        font-size: 12px;
        opacity: 0.7;
    }
    
    .ad-content {
        padding: 12px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .ad-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    
    .ad-category {
        font-size: 11px;
        background: rgba(0, 136, 204, 0.15);
        padding: 4px 8px;
        border-radius: 10px;
        color: var(--primary);
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 70%;
    }
    
    .ad-favorite {
        color: var(--gray-light);
        background: transparent;
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
        flex-shrink: 0;
    }
    
    .ad-favorite.active {
        color: var(--accent);
    }
    
    .ad-favorite:active {
        transform: scale(0.9);
    }
    
    .ad-title {
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 6px;
        color: var(--white);
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: 40px;
    }
    
    .ad-description {
        color: var(--gray-light);
        margin-bottom: 10px;
        font-size: 13px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex: 1;
    }
    
    .ad-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
    }
    
    .ad-price {
        font-weight: 700;
        color: var(--primary);
        font-size: 16px;
    }
    
    .ad-meta {
        font-size: 12px;
        color: var(--gray-light);
        display: flex;
        align-items: center;
        gap: 4px;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: var(--nav-bg);
        margin: 16px;
        border-radius: var(--radius);
        border: 1px solid var(--gray-dark);
        grid-column: 1 / -1;
    }
    
    .empty-state i {
        font-size: 48px;
        color: var(--gray-light);
        margin-bottom: 20px;
        opacity: 0.6;
    }
    
    .empty-state h3 {
        font-size: 18px;
        margin-bottom: 10px;
        color: var(--white);
        font-weight: 500;
    }
    
    .empty-state p {
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 25px;
        color: var(--gray-light);
    }

    /* Loading */
    .initial-loading {
        text-align: center;
        padding: 60px 20px;
        color: var(--gray-light);
        grid-column: 1 / -1;
    }
    
    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(0, 136, 204, 0.2);
        border-top: 3px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }

    /* Load More Button */
    .load-more {
        text-align: center;
        padding: 20px 16px;
        background: var(--chat-bg);
        grid-column: 1 / -1;
    }
    
    .load-more-btn {
        padding: 14px 28px;
        border: 1px solid var(--primary);
        border-radius: 25px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        background: transparent;
        color: var(--primary);
        width: 100%;
        max-width: 220px;
    }
    
    .load-more-btn:active {
        transform: scale(0.97);
        background: rgba(0, 136, 204, 0.1);
    }
    
    .load-more-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Error State */
    .error-state {
        text-align: center;
        padding: 60px 20px;
        background: var(--nav-bg);
        margin: 16px;
        border-radius: var(--radius);
        border: 1px solid var(--gray-dark);
        grid-column: 1 / -1;
    }
    
    .error-state i {
        font-size: 48px;
        color: var(--accent);
        margin-bottom: 20px;
        opacity: 0.7;
    }
    
    .error-state h3 {
        font-size: 18px;
        margin-bottom: 10px;
        color: var(--white);
        font-weight: 500;
    }
    
    .error-state p {
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 20px;
        color: var(--gray-light);
    }
    
    .retry-btn {
        padding: 14px 24px;
        border: 1px solid var(--primary);
        border-radius: 25px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        background: transparent;
        color: var(--primary);
        width: 100%;
        max-width: 220px;
    }
    
    .retry-btn:active {
        transform: scale(0.97);
        background: rgba(0, 136, 204, 0.1);
    }

    /* Bottom Navigation */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--nav-bg);
        display: flex;
        justify-content: space-around;
        padding: 8px 0 10px;
        border-top: 1px solid var(--gray-dark);
        z-index: 1000;
        height: 60px;
        max-width: 768px;
        margin: 0 auto;
    }
    
    .nav-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: var(--gray-light);
        font-size: 10px;
        padding: 6px 4px;
        transition: all 0.2s ease;
        flex: 1;
        position: relative;
        border: none;
        background: none;
        cursor: pointer;
    }
    
    .nav-btn i {
        font-size: 20px;
        margin-bottom: 2px;
        transition: all 0.2s ease;
    }
    
    .nav-btn.active {
        color: var(--primary);
    }
    
    .nav-btn.active i {
        transform: translateY(-1px);
    }
    
    .nav-btn.active::after {
        content: '';
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 30px;
        height: 3px;
        background: var(--primary);
        border-radius: 2px;
    }
    
    .nav-btn:active {
        transform: scale(0.95);
    }

    /* Quick Notification */
    .quick-notification {
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary);
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 500;
        z-index: 10000;
        animation: slideDown 0.3s ease;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    /* Animations */
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes slideDown {
        from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
        to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateX(-50%) translateY(0); opacity: 1; }
        to { transform: translateX(-50%) translateY(-20px); opacity: 0; }
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 480px) {
        .ad-image {
            height: 140px;
        }
        
        .ad-title {
            font-size: 14px;
        }
        
        .categories-scroll {
            padding: 10px 16px;
        }
        
        .category {
            padding: 6px 14px;
            font-size: 13px;
        }
    }
    
    @media (min-width: 481px) and (max-width: 768px) {
        .ads-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .ad-image {
            height: 180px;
        }
    }

    /* –•–æ–≤–µ—Ä-—ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –ü–ö */
    @media (hover: hover) {
        .category:hover {
            background: var(--gray-medium);
        }
        
        .category.active:hover {
            background: var(--primary-dark);
        }
        
        .ad-favorite:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .ad-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .load-more-btn:hover {
            background: rgba(0, 136, 204, 0.1);
        }
    }
</style>
</head>
<body>
    <div class="app-container">
        <!-- –•–ï–î–ï–† -->
        <div class="header">
            <div class="logo">
                <i class="fa fa-diamond"></i>
                <span>Zeeptook</span>
            </div>
            <div class="header-actions">
                <a href="messages.html" class="messages-btn">
                    <i class="fa fa-comment"></i>
                </a>
            </div>
        </div>
        
        <!-- –ü–û–ò–°–ö - –°–í–ï–†–•–£ -->
        <div class="search-section" id="search-section">
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –∏–≥—Ä–æ–≤—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤...">
                    <button id="search-btn">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ö–ê–¢–ï–ì–û–†–ò–ò - –ü–û–î –ü–û–ò–°–ö–û–ú -->
        <div class="categories-section" id="categories-section">
            <div class="categories-scroll" id="categories-container">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã -->
            </div>
        </div>
        
        <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
        <div class="content-wrapper">
            <div class="main-content">
                <div class="section-header">
                    <div class="section-title">–ò–≥—Ä–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã</div>
                </div>
                
                <div class="ads-grid" id="ads-container">
                    <div class="initial-loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</div>
                    </div>
                </div>
                
                <div class="load-more">
                    <button class="load-more-btn" id="load-more-btn" style="display: none;">–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë</button>
                </div>
            </div>
        </div>
        
        <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
        <div class="bottom-nav">
            <a href="index.html" class="nav-btn active">
                <i class="fa fa-home"></i>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </a>
            <a href="favorites.html" class="nav-btn">
                <i class="fa fa-heart"></i>
                <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </a>
            <a href="add-ad.html" class="nav-btn">
                <i class="fa fa-plus"></i>
                <span>–î–æ–±–∞–≤–∏—Ç—å</span>
            </a>
            <a href="server.html" class="nav-btn"> <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ê –°–°–´–õ–ö–ê -->
                <i class="fa fa-gamepad"></i>
                <span>–°–µ—Ä–≤–µ—Ä—ã</span>
            </a>
            <a href="profile.html" class="nav-btn">
                <i class="fa fa-user"></i>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </a>
        </div>
    </div>

    <script>
        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentPage = 1;
        let totalPages = 1;
        let currentCategory = 'all';
        let currentSearch = '';
        let isLoading = false;
        let lastScrollTop = 0;
        let isCategoriesVisible = true;
        let scrollTimeout;
        
        // –ë–∞–∑–æ–≤—ã–π URL API
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : '/api';
        
        // –ò–≥—Ä–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ)
        const gameCategories = [
            { name: '–í—Å–µ', data: 'all' },
            { name: 'PUBG Mobile', data: 'pubg' },
            { name: 'Free Fire', data: 'freefire' },
            { name: 'Call of Duty', data: 'cod' },
            { name: 'Genshin Impact', data: 'genshin' },
            { name: 'Mobile Legends', data: 'ml' },
            { name: 'Clash of Clans', data: 'coc' },
            { name: 'Brawl Stars', data: 'brawl' },
            { name: 'Roblox', data: 'roblox' }
        ];

        // –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function loadCategories() {
            const container = document.getElementById('categories-container');
            container.innerHTML = '';
            
            gameCategories.forEach(cat => {
                const categoryElement = document.createElement('div');
                categoryElement.className = cat.data === 'all' ? 'category active' : 'category';
                categoryElement.textContent = cat.name;
                categoryElement.setAttribute('data-category', cat.data);
                container.appendChild(categoryElement);
            });
            
            setupCategories();
        }

        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        async function fetchAds(page = 1, category = 'all', search = '') {
            if (isLoading) return;
            
            isLoading = true;
            const adsContainer = document.getElementById('ads-container');
            const loadMoreBtn = document.getElementById('load-more-btn');
            
            try {
                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                if (page === 1) {
                    adsContainer.innerHTML = `
                        <div class="initial-loading">
                            <div class="loading-spinner"></div>
                            <div>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</div>
                        </div>
                    `;
                } else {
                    loadMoreBtn.disabled = true;
                    loadMoreBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å —É—á–µ—Ç–æ–º –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫
                let url;
                try {
                    url = new URL(`${API_BASE}/ads`);
                } catch (e) {
                    url = new URL('/api/ads', window.location.origin);
                }
                
                url.searchParams.append('page', page);
                url.searchParams.append('limit', 12);
                
                if (category !== 'all') {
                    url.searchParams.append('category', category);
                }
                if (search) {
                    url.searchParams.append('search', search);
                }

                // –û–ø—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞
                const options = {
                    method: 'GET',
                    headers: {}
                };

                // –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                const token = localStorage.getItem('token');
                if (token) {
                    options.headers['Authorization'] = `Bearer ${token}`;
                }

                // –ó–∞–ø—Ä–æ—Å —Å —Ç–∞–π–º–∞—É—Ç–æ–º
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                options.signal = controller.signal;

                const response = await fetch(url.toString(), options);
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
                }

                const data = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                currentPage = data.page || page;
                totalPages = data.totalPages || 1;
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è
                displayAds(data.ads || [], page === 1);
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ"
                if (currentPage < totalPages) {
                    loadMoreBtn.style.display = 'block';
                    loadMoreBtn.disabled = false;
                    loadMoreBtn.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë';
                } else {
                    loadMoreBtn.style.display = 'none';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                
                // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                if (page === 1) {
                    showDemoAds();
                }
            } finally {
                isLoading = false;
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        function displayAds(adsArray, clearContainer = true) {
            const adsContainer = document.getElementById('ads-container');
            
            if (clearContainer) {
                adsContainer.innerHTML = '';
            }
            
            if (adsArray.length === 0 && clearContainer) {
                adsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fa fa-inbox"></i>
                        <h3>–û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
                    </div>
                `;
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤—Å—Ç–∞–≤–∫–∏
            const fragment = document.createDocumentFragment();
            
            adsArray.forEach((ad, index) => {
                const adElement = createAdCard(ad, index);
                fragment.appendChild(adElement);
            });
            
            adsContainer.appendChild(fragment);
            
            // –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            setTimeout(() => {
                loadImagesLazily(adsArray);
            }, 100);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        function createAdCard(ad, index) {
            const adElement = document.createElement('div');
            adElement.className = 'ad-card';
            adElement.setAttribute('data-ad-id', ad.id || index);
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            const priceFormatted = ad.price ? 
                new Intl.NumberFormat('ru-RU').format(ad.price) + ' ‚ÇΩ' : 
                '–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è';
            
            const timeAgo = formatTimeAgo(ad.created_at);
            const gameName = getGameNameFromCategory(ad.category);
            
            // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const isFavorite = favorites.some(fav => fav.id === ad.id);
            
            // HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
            adElement.innerHTML = `
                <div class="ad-image" data-ad-id="${ad.id || index}">
                    <div class="ad-image-placeholder">
                        <i class="fa fa-gamepad"></i>
                        <span>–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
                <div class="ad-content">
                    <div class="ad-header">
                        <div class="ad-category">${gameName}</div>
                        <button class="ad-favorite ${isFavorite ? 'active' : ''}" data-ad-id="${ad.id || index}">
                            <i class="fa fa-heart"></i>
                        </button>
                    </div>
                    <div class="ad-title">${ad.title || '–ò–≥—Ä–æ–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç'}</div>
                    <div class="ad-description">${ad.description || '–ê–∫–∫–∞—É–Ω—Ç —Å —Ö–æ—Ä–æ—à–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏'}</div>
                    <div class="ad-footer">
                        <div class="ad-price">${priceFormatted}</div>
                        <div class="ad-meta">
                            <span>${timeAgo}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            const favoriteBtn = adElement.querySelector('.ad-favorite');
            favoriteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(ad.id || index, favoriteBtn, ad);
            });
            
            adElement.addEventListener('click', () => {
                openAdDetails(ad.id || index);
            });
            
            return adElement;
        }

        // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function loadImagesLazily(adsArray) {
            const imageContainers = document.querySelectorAll('.ad-image');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const container = entry.target;
                        const adId = container.getAttribute('data-ad-id');
                        const ad = adsArray.find(a => (a.id || a.index) == adId);
                        
                        if (ad) {
                            loadImage(container, ad);
                        }
                        observer.unobserve(container);
                    }
                });
            }, {
                rootMargin: '50px 0px',
                threshold: 0.1
            });
            
            imageContainers.forEach(container => {
                observer.observe(container);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function loadImage(container, ad) {
            const placeholder = container.querySelector('.ad-image-placeholder');
            const imageUrl = getImageUrl(ad);
            
            if (!imageUrl) {
                if (placeholder) {
                    placeholder.querySelector('span').textContent = '–ù–µ—Ç —Ñ–æ—Ç–æ';
                }
                return;
            }
            
            const img = new Image();
            img.onload = function() {
                container.innerHTML = '';
                const imgElement = document.createElement('img');
                imgElement.className = 'ad-image-img';
                imgElement.src = imageUrl;
                imgElement.alt = ad.title || '–ò–≥—Ä–æ–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç';
                
                container.appendChild(imgElement);
                
                // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
                setTimeout(() => {
                    imgElement.classList.add('loaded');
                }, 50);
            };
            
            img.onerror = function() {
                if (placeholder) {
                    placeholder.querySelector('span').textContent = '–û—à–∏–±–∫–∞';
                }
            };
            
            img.src = imageUrl;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function getImageUrl(ad) {
            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: photos[0] -> image -> –¥–µ–º–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (ad.photos && ad.photos.length > 0) {
                const photo = ad.photos[0];
                if (photo.image_data) {
                    if (photo.image_data.startsWith('http') || photo.image_data.startsWith('data:image')) {
                        return photo.image_data;
                    } else if (photo.image_data.length > 100) {
                        return `data:image/jpeg;base64,${photo.image_data}`;
                    }
                }
            }
            
            if (ad.image && (ad.image.startsWith('http') || ad.image.startsWith('data:image'))) {
                return ad.image;
            }
            
            // –î–µ–º–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            return getDemoImage(ad.category);
        }

        // –î–µ–º–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∏–≥—Ä
        function getDemoImage(category) {
            const gameImages = {
                'pubg': 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&h=300&fit=crop',
                'freefire': 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&h=300&fit=crop',
                'cod': 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&h=300&fit=crop',
                'genshin': 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&h=300&fit=crop',
                'ml': 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=400&h=300&fit=crop',
                'default': 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w-400&h=300&fit=crop'
            };
            
            return gameImages[category] || gameImages.default;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–≥—Ä—ã –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function getGameNameFromCategory(category) {
            const gameMap = {
                'pubg': 'PUBG Mobile',
                'freefire': 'Free Fire',
                'cod': 'Call of Duty',
                'genshin': 'Genshin Impact',
                'ml': 'Mobile Legends',
                'coc': 'Clash of Clans',
                'brawl': 'Brawl Stars',
                'roblox': 'Roblox'
            };
            
            return gameMap[category] || category || '–ò–≥—Ä—ã';
        }

        // –î–µ–º–æ-–æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
        function showDemoAds() {
            const demoAds = [
                {
                    id: 1,
                    title: 'PUBG Mobile –ê–∫–∫–∞—É–Ω—Ç',
                    description: '–ê–∫–∫–∞—É–Ω—Ç —Å —Ä–µ–¥–∫–∏–º–∏ —Å–∫–∏–Ω–∞–º–∏ –∏ –≤—ã—Å–æ–∫–∏–º —É—Ä–æ–≤–Ω–µ–º',
                    price: 3700,
                    category: 'pubg',
                    created_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 2,
                    title: 'Call of Duty Mobile',
                    description: 'Full account —Å –æ—Ä—É–∂–∏–µ–º 50 —É—Ä–æ–≤–Ω—è',
                    price: 3700,
                    category: 'cod',
                    created_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 3,
                    title: 'Free Fire –ü—Ä–µ–º–∏—É–º',
                    description: '–ê–∫–∫–∞—É–Ω—Ç —Å –±–æ–µ–≤—ã–º –ø—Ä–æ–ø—É—Å–∫–æ–º',
                    price: 2500,
                    category: 'freefire',
                    created_at: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 4,
                    title: 'Genshin Impact AR55',
                    description: '–ê–∫–∫–∞—É–Ω—Ç —Å 5* –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏',
                    price: 5000,
                    category: 'genshin',
                    created_at: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 5,
                    title: 'Mobile Legends –ú–∏—Ñ–∏–∫',
                    description: '–í—ã—Å–æ–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥, –º–Ω–æ–≥–æ –≥–µ—Ä–æ–µ–≤',
                    price: 3200,
                    category: 'ml',
                    created_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 6,
                    title: 'Clash of Clans TH13',
                    description: '–ì–æ—Ä–æ–¥–æ–∫ 13 —É—Ä–æ–≤–Ω—è, –ø–æ–ª–Ω–∞—è –ø—Ä–æ–∫–∞—á–∫–∞',
                    price: 4200,
                    category: 'coc',
                    created_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()
                }
            ];
            
            displayAds(demoAds, true);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ"
            document.getElementById('load-more-btn').style.display = 'none';
        }

        // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        function toggleFavorite(adId, favoriteBtn, ad) {
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            if (favoriteBtn.classList.contains('active')) {
                favorites = favorites.filter(fav => fav.id !== adId);
                favoriteBtn.classList.remove('active');
                showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
            } else {
                const favoriteAd = {
                    id: adId,
                    title: ad.title,
                    price: ad.price,
                    category: ad.category,
                    description: ad.description
                };
                favorites.push(favoriteAd);
                favoriteBtn.classList.add('active');
                showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        function openAdDetails(adId) {
            window.location.href = `ad-details.html?id=${adId}`;
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatTimeAgo(dateString) {
            if (!dateString) return '> –Ω–µ–¥';
            
            try {
                const now = new Date();
                const date = new Date(dateString);
                const diffMs = now - date;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffDays < 1) return '—Å–µ–≥–æ–¥–Ω—è';
                if (diffDays < 2) return '–≤—á–µ—Ä–∞';
                if (diffDays < 7) return `${diffDays} –¥`;
                if (diffDays < 30) return `${Math.floor(diffDays / 7)} –Ω–µ–¥`;
                return `${Math.floor(diffDays / 30)} –º–µ—Å`;
            } catch (e) {
                return '> –Ω–µ–¥';
            }
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message) {
            const existing = document.querySelector('.quick-notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'quick-notification';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞
        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            
            const performSearch = () => {
                currentSearch = searchInput.value.trim();
                currentPage = 1;
                fetchAds(1, currentCategory, currentSearch);
            };
            
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function setupCategories() {
            const categories = document.querySelectorAll('.category');
            categories.forEach(category => {
                category.addEventListener('click', function() {
                    const categoryValue = this.getAttribute('data-category');
                    
                    categories.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentCategory = categoryValue;
                    currentPage = 1;
                    fetchAds(1, currentCategory, currentSearch);
                });
            });
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
        function setupScrollAnimation() {
            const searchSection = document.getElementById('search-section');
            const categoriesSection = document.getElementById('categories-section');
            let isHidden = false;
            
            window.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const isScrollingDown = scrollTop > lastScrollTop;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –≤–Ω–∏–∑, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –≤–≤–µ—Ä—Ö –∏–ª–∏ –≤–≤–µ—Ä—Ö—É
                if (isScrollingDown && scrollTop > 100 && !isHidden) {
                    searchSection.style.transform = 'translateY(0)';
                    categoriesSection.style.transform = 'translateY(-100%)';
                    isHidden = true;
                } else if ((!isScrollingDown || scrollTop <= 100) && isHidden) {
                    searchSection.style.transform = 'translateY(0)';
                    categoriesSection.style.transform = 'translateY(0)';
                    isHidden = false;
                }
                
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
                
                // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–∫—Ä—ã—Ç–∏–µ–º
                scrollTimeout = setTimeout(() => {
                    if (scrollTop <= 100 && isHidden) {
                        searchSection.style.transform = 'translateY(0)';
                        categoriesSection.style.transform = 'translateY(0)';
                        isHidden = false;
                    }
                }, 150);
            }, { passive: true });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Zeeptook –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            loadCategories();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–∏—Å–∫
            setupSearch();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª-–∞–Ω–∏–º–∞—Ü–∏—é
            setupScrollAnimation();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è
            fetchAds();
            
            // –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ"
            const loadMoreBtn = document.getElementById('load-more-btn');
            loadMoreBtn.addEventListener('click', () => {
                fetchAds(currentPage + 1, currentCategory, currentSearch);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            const style = document.createElement('style');
            style.textContent = `
                .search-section, .categories-section {
                    transition: transform 0.3s ease;
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>

